<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 관리자 페이지 -->
<mapper namespace="admin">

	<!-- 1. 게시판 대분류 카테고리 생성  -->
	<insert id="makeCategory" parameterType="java.lang.String" >
		insert into boardCategory(boardCategoryName) values(#{boardCategoryName})
	</insert>

	<!-- 2. 대분류 카테고리에 속하는 진짜 게시판 이름과 인덱스 생성 -->
	<insert id="makeBoard" parameterType="com.tjoeun.spring.dto.BoardDTO" >
		insert into boardInCategory(boardName, boardCategoryNo) values(#{boardName}, #{boardCategoryNo})
	</insert>
	
	<!-- 3. 게시판 이름 변경 -->
	<update id="changeBoardName" parameterType="com.tjoeun.spring.dto.BoardDTO" >
		update boardInCategory 
		set boardName = #{boardName}
		where boardNo = #{boardNo}
	</update>
	
	<!-- 4. 게시판 제거  -->
	<delete id="deleteBoard" parameterType="java.lang.Integer">
		delete from boardInCategory where boardNo =#{boardNo}
	</delete>
	
	
	<!-- 4. 게시판 상위 카테고리 제거  -->
	<delete id="deleteCategory" parameterType="java.lang.Integer">
		delete from boardCategory where boardCategoryNo =#{boardCategoryNo}
	</delete>
	
	
	<!-- 회원목록 가져오기 -->
	<select id="takeMemberList" resultType="com.tjoeun.spring.dto.MemberDTO">
		select m.memberNo, m.email, m.nick, m.signUpdate, 
		(select count(*) from freeboard f where f.writer =m.nick ) as 'postCount', 
		(select count(*) from reply r where r.replyWriter =m.nick ) as 'replyCount'
		from members m
		order by memberNo asc	
	</select>
	
	
	<!-- AJAX 게시글 검색 	-->
	<select id="searchList" parameterType="com.tjoeun.spring.dto.MemberDTO" resultType="com.tjoeun.spring.dto.MemberDTO">
		select m.memberNo, m.email, m.nick, DATE_FORMAT (m.signUpDate, '%Y년%m월%d일 %H시%i분%S초') as signUp_Date, 
				(select count(*) from freeboard f where f.writer =m.nick ) as 'postCount', 
				(select count(*) from reply r where r.replyWriter =m.nick ) as 'replyCount'
		from members m
		where 
		<if test="type!=null and type == 'email'">
			email like CONCAT('%',#{keyword},'%')
		</if>
		<if test="type!=null and type == 'nick'">
			nick like CONCAT('%',#{keyword},'%')
		</if>
			order by memberNo DESC 
	</select>

	<!-- 특정한 한 회원이 쓴글의 수 -->
	<select id="postCount" parameterType="java.lang.String" resultType="java.lang.Integer">
		select count(*) from freeBoard where writer = #{writer}	
	</select>	
		
	<!-- 특정한 한 회원이 쓴글의 수 -->
	<select id="replyCount" parameterType="java.lang.String" resultType="java.lang.Integer">
		select count(*) from reply where writer = #{writer}	
	</select>		




		
</mapper>